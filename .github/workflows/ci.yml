name: ðŸš€ CI: Lint & Build Docker

on: [push, pull_request]]

jobs:
  lint:
    name: Lint
    runs-on: ubuntu-latest

    steps:
        uses: actions/checkout@v4

        uses: actions/setup-node@v4
        with:
          node-version: 18

        run: |
          cd pinger-site
          npm install

        run: cd pinger-site && npx eslint --ext .js,.jsx,.ts,.tsx src/

        run: cd pinger-site && npx prettier --check "src/**/*.{js,jsx,ts,tsx,json,css,md}"

        uses: actions/setup-go@v5
        with:
          go-version: 1.21

        run: |
          go install golang.org/x/tools/cmd/goimports@latest
          goimports -d ./server

  docker-build:
    name: ðŸ³ Ð¡Ð±Ð¾Ñ€ÐºÐ° Docker-ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²
    runs-on: ubuntu-latest
    needs: lint

    steps:
        uses: actions/checkout@v4

        run: |
          echo "VITE_API_URL=http://localhost:4000" > pinger-site/.env

        run: |
          sudo apt update
          sudo apt install -y docker.io docker-compose

        run: |
          sudo docker compose build

        run: sudo docker images
